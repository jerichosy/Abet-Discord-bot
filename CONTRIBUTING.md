# CONTRIBUTING

## Dev container intricacies:
- Since the production service 'bot' in the [docker-compose.yml](docker-compose.yml) is [extended by the dev container](.devcontainer/devcontainer.json) and [just overrides it for dev purposes](.devcontainer/docker-compose.yml), opening the dev container while a production service 'bot' is running will shut prod down and attempt to recreate the same 'bot' service supposedly with dev overrides but failing as the image needs to be rebuilt (and vice versa). In other words, both prod and dev container uses the same image and only one (1) environment can exist at a time. But, developing in prod is desirable here since it is easier (no need to sync slash commands twice), no users are usually affected (no one really uses the bot), and in-line with traditions on how the bot was always developed even before being Dockerized and set up with dev containers. So the intricacy of prod being killed to spin up the devcontainer (and vice versa) is actually desirable. Just know that when switching environments, the image has to be rebuilt.

## Conventions:
- When receiving user input that is too long, explicitly reject it. Do not truncate it as that is only meant for output (display).
- When specifying URL variables, do not include the trailing slash (`/`) as part of the hostname. Instead, it should be the prefix of the URL path as it is clearer and is in-line with how routes are declared in web frameworks (e.g. Express, FastAPI).
- Do not create an `aiohttp.ClientSession` per request. Instead, reuse the existing session either through `ctx.session` or `bot.session` to take advantage of the connection pool and keep-alive which may speed up performance.
- Lazy initialize whenever possible and practical (e.g. clients, web APIs). Do not preemptively populate data like what was done for [`waifu_im_tags`](https://github.com/jerichosy/Abet-Discord-bot/blob/f06aab841dadd2c96fa81f4a6a277fa3e2dd5e96/cogs/Fun.py#L222-L228) and [`ExchangeRateUSDPHP`](https://github.com/jerichosy/Abet-Discord-bot/blob/f06aab841dadd2c96fa81f4a6a277fa3e2dd5e96/cogs/utils/ExchangeRateUSDPHP.py#L13-L14) before. Exceptions to this include the database (it's easier to catch an issue on startup) and `aiohttp.ClientSession`.
- Do not use naive `datetime` objects. This can be an issue when running the bot on systems with timezones other than UTC+00:00. See commit [739247d](https://github.com/jerichosy/Abet-Discord-bot/commit/739247da1d519fe25d3e0a994fedaea68974b045).
